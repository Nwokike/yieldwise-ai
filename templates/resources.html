{% extends "base.html" %}

{% block title %}Resource Calculator - YieldWise AI{% endblock %}

{% block extra_css %}
<style>
    .calculator-header {
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-dark) 100%);
        color: white;
        padding: 60px 0 40px;
        margin-bottom: 40px;
    }
    
    .calculator-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }
    
    .calculator-card .accordion-button {
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        color: white;
        font-weight: 600;
        font-size: 1.2rem;
        padding: 1.5rem;
    }
    
    .calculator-card .accordion-button:not(.collapsed) {
        background: var(--primary-green-dark);
        color: white;
    }
    
    .calculator-card .accordion-button::after {
        filter: brightness(0) invert(1);
    }
    
    .calculator-card .accordion-body {
        padding: 2rem;
        background: #f8f9fa;
    }
    
    .result-box {
        background: white;
        border-left: 4px solid var(--primary-green);
        padding: 1.5rem;
        border-radius: 10px;
        margin-top: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    
    .result-box h5 {
        color: var(--primary-green);
        font-weight: 700;
        margin-bottom: 1rem;
    }
    
    .result-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-green);
    }
    
    .icon-large {
        font-size: 3rem;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="calculator-header">
    <div class="container text-center">
        <h1 class="display-4 fw-bold">
            <i class="bi bi-calculator"></i> Smart Resource Calculator
        </h1>
        <p class="lead mt-3">Calculate exact requirements for seeds, water, fertilizer, and labor - supporting 50+ crop types!</p>
    </div>
</div>

<div class="container pb-5">
    <div class="accordion" id="calculatorAccordion">
        
        <div class="calculator-card">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#seedsCalc">
                    <i class="bi bi-seeds me-3"></i> Seeds Calculator (50+ Crops)
                </button>
            </h2>
            <div id="seedsCalc" class="accordion-collapse collapse show" data-bs-parent="#calculatorAccordion">
                <div class="accordion-body">
                    <div class="text-center icon-large text-primary">
                        <i class="bi bi-seeds"></i>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Crop Type</label>
                            <select class="form-select form-select-lg" id="seed-crop">
                                <optgroup label="Vegetables">
                                    <option value="tomato">Tomato</option>
                                    <option value="pepper">Bell Pepper</option>
                                    <option value="chili">Chili Pepper</option>
                                    <option value="onion">Onion</option>
                                    <option value="garlic">Garlic</option>
                                    <option value="lettuce">Lettuce</option>
                                    <option value="cabbage">Cabbage</option>
                                    <option value="spinach">Spinach</option>
                                    <option value="kale">Kale</option>
                                    <option value="carrot">Carrot</option>
                                    <option value="cucumber">Cucumber</option>
                                    <option value="eggplant">Eggplant</option>
                                    <option value="okra">Okra</option>
                                    <option value="pumpkin">Pumpkin</option>
                                    <option value="squash">Squash</option>
                                    <option value="watermelon">Watermelon</option>
                                </optgroup>
                                <optgroup label="Grains & Cereals">
                                    <option value="maize">Maize/Corn</option>
                                    <option value="rice">Rice</option>
                                    <option value="wheat">Wheat</option>
                                    <option value="barley">Barley</option>
                                    <option value="sorghum">Sorghum</option>
                                    <option value="millet">Millet</option>
                                    <option value="oats">Oats</option>
                                </optgroup>
                                <optgroup label="Legumes">
                                    <option value="beans">Beans</option>
                                    <option value="peas">Peas</option>
                                    <option value="soybeans">Soybeans</option>
                                    <option value="lentils">Lentils</option>
                                    <option value="chickpeas">Chickpeas</option>
                                    <option value="cowpeas">Cowpeas</option>
                                    <option value="peanuts">Peanuts/Groundnuts</option>
                                </optgroup>
                                <optgroup label="Root Crops">
                                    <option value="cassava">Cassava</option>
                                    <option value="yam">Yam</option>
                                    <option value="potato">Potato</option>
                                    <option value="sweetpotato">Sweet Potato</option>
                                    <option value="taro">Taro</option>
                                    <option value="ginger">Ginger</option>
                                    <option value="turmeric">Turmeric</option>
                                </optgroup>
                                <optgroup label="Fruits">
                                    <option value="banana">Banana</option>
                                    <option value="plantain">Plantain</option>
                                    <option value="mango">Mango</option>
                                    <option value="papaya">Papaya</option>
                                    <option value="pineapple">Pineapple</option>
                                    <option value="strawberry">Strawberry</option>
                                </optgroup>
                                <optgroup label="Cash Crops">
                                    <option value="cotton">Cotton</option>
                                    <option value="coffee">Coffee</option>
                                    <option value="cocoa">Cocoa</option>
                                    <option value="sugarcane">Sugarcane</option>
                                    <option value="tobacco">Tobacco</option>
                                    <option value="tea">Tea</option>
                                </optgroup>
                                <optgroup label="Herbs & Spices">
                                    <option value="basil">Basil</option>
                                    <option value="cilantro">Cilantro/Coriander</option>
                                    <option value="parsley">Parsley</option>
                                    <option value="mint">Mint</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Farm Size</label>
                            <select class="form-select form-select-lg" id="seed-area">
                                <option value="50">50 sqm (Small backyard)</option>
                                <option value="100">100 sqm</option>
                                <option value="200">200 sqm</option>
                                <option value="500">500 sqm</option>
                                <option value="1000" selected>1000 sqm (0.1 hectare)</option>
                                <option value="2000">2000 sqm (0.2 hectare)</option>
                                <option value="5000">5000 sqm (0.5 hectare)</option>
                                <option value="10000">10,000 sqm (1 hectare)</option>
                                <option value="20000">20,000 sqm (2 hectares)</option>
                                <option value="50000">50,000 sqm (5 hectares)</option>
                                <option value="100000">100,000 sqm (10 hectares)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="calculateSeeds()" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-calculator"></i> Calculate Seeds Needed
                    </button>
                    
                    <div id="seed-result" class="result-box" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="calculator-card">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#waterCalc">
                    <i class="bi bi-droplet me-3"></i> Water Calculator (All Climates)
                </button>
            </h2>
            <div id="waterCalc" class="accordion-collapse collapse" data-bs-parent="#calculatorAccordion">
                <div class="accordion-body">
                    <div class="text-center icon-large text-primary">
                        <i class="bi bi-droplet"></i>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Crop Type</label>
                            <select class="form-select form-select-lg" id="water-crop">
                                <option value="tomato">Tomato</option>
                                <option value="pepper">Pepper</option>
                                <option value="lettuce">Lettuce</option>
                                <option value="cabbage">Cabbage</option>
                                <option value="carrot">Carrot</option>
                                <option value="cucumber">Cucumber</option>
                                <option value="eggplant">Eggplant</option>
                                <option value="maize">Maize/Corn</option>
                                <option value="rice">Rice</option>
                                <option value="wheat">Wheat</option>
                                <option value="sorghum">Sorghum</option>
                                <option value="beans">Beans</option>
                                <option value="cassava">Cassava</option>
                                <option value="potato">Potato</option>
                                <option value="sweetpotato">Sweet Potato</option>
                                <option value="banana">Banana</option>
                                <option value="sugarcane">Sugarcane</option>
                                <option value="cotton">Cotton</option>
                                <option value="coffee">Coffee</option>
                                <option value="cocoa">Cocoa</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Farm Size</label>
                            <select class="form-select form-select-lg" id="water-area">
                                <option value="100">100 sqm</option>
                                <option value="500">500 sqm</option>
                                <option value="1000" selected>1000 sqm</option>
                                <option value="5000">5000 sqm (0.5 ha)</option>
                                <option value="10000">1 hectare</option>
                                <option value="50000">5 hectares</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Climate Zone</label>
                            <select class="form-select form-select-lg" id="water-climate">
                                <option value="tropical-wet">Tropical Wet (High Rainfall)</option>
                                <option value="tropical-dry">Tropical Dry (Seasonal Rainfall)</option>
                                <option value="subtropical">Subtropical</option>
                                <option value="temperate">Temperate</option>
                                <option value="mediterranean">Mediterranean</option>
                                <option value="arid">Arid/Desert (Low Rainfall)</option>
                                <option value="semi-arid">Semi-Arid</option>
                                <option value="humid">Humid Continental</option>
                                <option value="savanna">Savanna</option>
                                <option value="monsoon">Monsoon</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="calculateWater()" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-calculator"></i> Calculate Water Requirements
                    </button>
                    
                    <div id="water-result" class="result-box" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="calculator-card">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fertCalc">
                    <i class="bi bi-flower3 me-3"></i> Fertilizer Calculator (All Soil Types)
                </button>
            </h2>
            <div id="fertCalc" class="accordion-collapse collapse" data-bs-parent="#calculatorAccordion">
                <div class="accordion-body">
                    <div class="text-center icon-large text-primary">
                        <i class="bi bi-flower3"></i>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Crop Type</label>
                            <select class="form-select form-select-lg" id="fert-crop">
                                <option value="tomato">Tomato</option>
                                <option value="pepper">Pepper</option>
                                <option value="maize">Maize/Corn</option>
                                <option value="rice">Rice</option>
                                <option value="wheat">Wheat</option>
                                <option value="beans">Beans</option>
                                <option value="cassava">Cassava</option>
                                <option value="potato">Potato</option>
                                <option value="sugarcane">Sugarcane</option>
                                <option value="cotton">Cotton</option>
                                <option value="vegetables">Leafy Vegetables</option>
                                <option value="fruits">Fruit Trees</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Farm Size</label>
                            <select class="form-select form-select-lg" id="fert-area">
                                <option value="100">100 sqm</option>
                                <option value="500">500 sqm</option>
                                <option value="1000" selected>1000 sqm</option>
                                <option value="5000">5000 sqm (0.5 ha)</option>
                                <option value="10000">1 hectare</option>
                                <option value="50000">5 hectares</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label fw-bold">Soil Type</label>
                            <select class="form-select form-select-lg" id="fert-soil">
                                <option value="clay">Clay Soil</option>
                                <option value="sandy">Sandy Soil</option>
                                <option value="loam">Loam (Ideal)</option>
                                <option value="silty">Silty Soil</option>
                                <option value="peaty">Peaty Soil</option>
                                <option value="chalky">Chalky Soil</option>
                                <option value="laterite">Laterite Soil</option>
                                <option value="alluvial">Alluvial Soil</option>
                                <option value="black">Black Cotton Soil</option>
                                <option value="red">Red Soil</option>
                                <option value="volcanic">Volcanic Soil</option>
                                <option value="acidic">Acidic Soil (pH <6)</option>
                                <option value="alkaline">Alkaline Soil (pH >7.5)</option>
                                <option value="saline">Saline Soil</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="calculateFertilizer()" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-calculator"></i> Calculate Fertilizer Needs
                    </button>
                    
                    <div id="fert-result" class="result-box" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="calculator-card">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#laborCalc">
                    <i class="bi bi-people me-3"></i> Labor Calculator (All Activities)
                </button>
            </h2>
            <div id="laborCalc" class="accordion-collapse collapse" data-bs-parent="#calculatorAccordion">
                <div class="accordion-body">
                    <div class="text-center icon-large text-primary">
                        <i class="bi bi-people"></i>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Farm Activity</label>
                            <select class="form-select form-select-lg" id="labor-activity">
                                <optgroup label="Land Preparation">
                                    <option value="clearing">Land Clearing</option>
                                    <option value="plowing">Plowing/Tilling</option>
                                    <option value="harrowing">Harrowing</option>
                                    <option value="ridging">Ridging/Bed Making</option>
                                </optgroup>
                                <optgroup label="Planting">
                                    <option value="planting">Manual Planting</option>
                                    <option value="transplanting">Transplanting Seedlings</option>
                                    <option value="broadcasting">Broadcasting Seeds</option>
                                </optgroup>
                                <optgroup label="Maintenance">
                                    <option value="weeding">Manual Weeding</option>
                                    <option value="mulching">Mulching</option>
                                    <option value="pruning">Pruning</option>
                                    <option value="staking">Staking/Support</option>
                                </optgroup>
                                <optgroup label="Irrigation">
                                    <option value="irrigation-setup">Irrigation System Setup</option>
                                    <option value="watering">Manual Watering</option>
                                </optgroup>
                                <optgroup label="Pest/Disease Control">
                                    <option value="spraying">Spraying (Pesticides/Fertilizer)</option>
                                    <option value="scouting">Pest Scouting</option>
                                </optgroup>
                                <optgroup label="Harvesting">
                                    <option value="harvesting">Manual Harvesting</option>
                                    <option value="sorting">Sorting & Grading</option>
                                    <option value="packing">Packing</option>
                                </optgroup>
                                <optgroup label="Post-Harvest">
                                    <option value="drying">Drying</option>
                                    <option value="storage">Storage Management</option>
                                    <option value="transport">Loading/Transportation</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold">Farm Size</label>
                            <select class="form-select form-select-lg" id="labor-area">
                                <option value="100">100 sqm</option>
                                <option value="500">500 sqm</option>
                                <option value="1000" selected>1000 sqm</option>
                                <option value="5000">5000 sqm (0.5 ha)</option>
                                <option value="10000">1 hectare</option>
                                <option value="50000">5 hectares</option>
                                <option value="100000">10 hectares</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="calculateLabor()" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-calculator"></i> Calculate Labor Requirements
                    </button>
                    
                    <div id="labor-result" class="result-box" style="display: none;"></div>
                </div>
            </div>
        </div>

    </div>
    
    {% if current_user.is_authenticated %}
    <div class="alert alert-info mt-5">
        <h5><i class="bi bi-lightbulb"></i> Pro Tip!</h5>
        <p class="mb-0">Save your calculations by creating farm plans in the <a href="{{ url_for('dashboard') }}" class="alert-link">Dashboard</a>. You can also get AI-powered crop recommendations!</p>
    </div>
    {% else %}
    <div class="alert alert-success mt-5">
        <h5><i class="bi bi-star"></i> Want to Save Your Calculations?</h5>
        <p class="mb-2">Create a free account to save all your calculations, generate AI farm plans, and access Plant Doctor!</p>
        <a href="{{ url_for('register') }}" class="btn btn-primary">Create Free Account</a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
const SEED_RATES = {
    tomato: { rate: 0.15, unit: 'kg', name: 'Tomato' },
    pepper: { rate: 0.25, unit: 'kg', name: 'Bell Pepper' },
    chili: { rate: 0.2, unit: 'kg', name: 'Chili Pepper' },
    onion: { rate: 2, unit: 'kg', name: 'Onion' },
    garlic: { rate: 400, unit: 'kg', name: 'Garlic' },
    lettuce: { rate: 0.5, unit: 'kg', name: 'Lettuce' },
    cabbage: { rate: 0.3, unit: 'kg', name: 'Cabbage' },
    spinach: { rate: 2, unit: 'kg', name: 'Spinach' },
    kale: { rate: 0.5, unit: 'kg', name: 'Kale' },
    carrot: { rate: 2.5, unit: 'kg', name: 'Carrot' },
    cucumber: { rate: 1, unit: 'kg', name: 'Cucumber' },
    eggplant: { rate: 0.2, unit: 'kg', name: 'Eggplant' },
    okra: { rate: 8, unit: 'kg', name: 'Okra' },
    pumpkin: { rate: 0.5, unit: 'kg', name: 'Pumpkin' },
    squash: { rate: 0.7, unit: 'kg', name: 'Squash' },
    watermelon: { rate: 0.5, unit: 'kg', name: 'Watermelon' },
    maize: { rate: 25, unit: 'kg', name: 'Maize/Corn' },
    rice: { rate: 120, unit: 'kg', name: 'Rice' },
    wheat: { rate: 120, unit: 'kg', name: 'Wheat' },
    barley: { rate: 100, unit: 'kg', name: 'Barley' },
    sorghum: { rate: 12, unit: 'kg', name: 'Sorghum' },
    millet: { rate: 8, unit: 'kg', name: 'Millet' },
    oats: { rate: 80, unit: 'kg', name: 'Oats' },
    beans: { rate: 60, unit: 'kg', name: 'Beans' },
    peas: { rate: 90, unit: 'kg', name: 'Peas' },
    soybeans: { rate: 75, unit: 'kg', name: 'Soybeans' },
    lentils: { rate: 40, unit: 'kg', name: 'Lentils' },
    chickpeas: { rate: 75, unit: 'kg', name: 'Chickpeas' },
    cowpeas: { rate: 45, unit: 'kg', name: 'Cowpeas' },
    peanuts: { rate: 90, unit: 'kg', name: 'Peanuts' },
    cassava: { rate: 400, unit: 'stem cuttings', name: 'Cassava' },
    yam: { rate: 1500, unit: 'kg setts', name: 'Yam' },
    potato: { rate: 2000, unit: 'kg seed tubers', name: 'Potato' },
    sweetpotato: { rate: 300, unit: 'kg vines', name: 'Sweet Potato' },
    taro: { rate: 800, unit: 'kg corms', name: 'Taro' },
    ginger: { rate: 1500, unit: 'kg rhizomes', name: 'Ginger' },
    turmeric: { rate: 2000, unit: 'kg rhizomes', name: 'Turmeric' },
    banana: { rate: 1600, unit: 'suckers', name: 'Banana' },
    plantain: { rate: 1600, unit: 'suckers', name: 'Plantain' },
    mango: { rate: 100, unit: 'seedlings', name: 'Mango' },
    papaya: { rate: 200, unit: 'seeds (grams)', name: 'Papaya' },
    pineapple: { rate: 40000, unit: 'suckers', name: 'Pineapple' },
    strawberry: { rate: 50000, unit: 'plants', name: 'Strawberry' },
    cotton: { rate: 25, unit: 'kg', name: 'Cotton' },
    coffee: { rate: 2500, unit: 'seedlings', name: 'Coffee' },
    cocoa: { rate: 1100, unit: 'seedlings', name: 'Cocoa' },
    sugarcane: { rate: 7500, unit: 'kg setts', name: 'Sugarcane' },
    tobacco: { rate: 0.15, unit: 'kg', name: 'Tobacco' },
    tea: { rate: 13000, unit: 'seedlings', name: 'Tea' },
    basil: { rate: 0.1, unit: 'kg', name: 'Basil' },
    cilantro: { rate: 6, unit: 'kg', name: 'Cilantro' },
    parsley: { rate: 3, unit: 'kg', name: 'Parsley' },
    mint: { rate: 50000, unit: 'cuttings', name: 'Mint' }
};

const WATER_RATES = {
    'tropical-wet': 0.8, 'tropical-dry': 1.2, 'subtropical': 1.0,
    'temperate': 0.9, 'mediterranean': 1.1, 'arid': 1.5,
    'semi-arid': 1.3, 'humid': 0.85, 'savanna': 1.1, 'monsoon': 0.9
};

const CROP_WATER = {
    tomato: 5, pepper: 4.5, lettuce: 2, cabbage: 3, carrot: 2.5,
    cucumber: 5, eggplant: 4, maize: 6, rice: 12, wheat: 4.5,
    sorghum: 3.5, beans: 4, cassava: 2.5, potato: 5, sweetpotato: 3.5,
    banana: 8, sugarcane: 15, cotton: 6, coffee: 7, cocoa: 6
};

const LABOR_RATES = {
    clearing: 8, plowing: 6, harrowing: 5, ridging: 7,
    planting: 10, transplanting: 12, broadcasting: 4,
    weeding: 15, mulching: 8, pruning: 10, staking: 6,
    'irrigation-setup': 12, watering: 5, spraying: 3, scouting: 2,
    harvesting: 20, sorting: 10, packing: 8,
    drying: 4, storage: 3, transport: 5
};

function calculateSeeds() {
    const crop = document.getElementById('seed-crop').value;
    const area = parseFloat(document.getElementById('seed-area').value);
    
    const data = SEED_RATES[crop];
    const total = (data.rate * area / 1000).toFixed(2);
    
    document.getElementById('seed-result').innerHTML = `
        <h5><i class="bi bi-check-circle"></i> Seeds Required for ${data.name}</h5>
        <div class="result-value">${total} ${data.unit}</div>
        <p class="mt-2 text-muted">For ${area} sqm farm area</p>
        <p class="mb-0"><strong>Recommendation:</strong> Buy 10-15% extra for replanting and losses.</p>
    `;
    document.getElementById('seed-result').style.display = 'block';
}

function calculateWater() {
    const crop = document.getElementById('water-crop').value;
    const area = parseFloat(document.getElementById('water-area').value);
    const climate = document.getElementById('water-climate').value;
    
    const baseWater = CROP_WATER[crop] || 4;
    const climateFactor = WATER_RATES[climate] || 1;
    const daily = (baseWater * climateFactor * area / 1000).toFixed(1);
    const weekly = (daily * 7).toFixed(1);
    const monthly = (daily * 30).toFixed(1);
    
    document.getElementById('water-result').innerHTML = `
        <h5><i class="bi bi-droplet-fill"></i> Water Requirements</h5>
        <div class="row text-center">
            <div class="col-4">
                <div class="result-value">${daily}</div>
                <p class="text-muted mb-0">liters/day</p>
            </div>
            <div class="col-4">
                <div class="result-value">${weekly}</div>
                <p class="text-muted mb-0">liters/week</p>
            </div>
            <div class="col-4">
                <div class="result-value">${monthly}</div>
                <p class="text-muted mb-0">liters/month</p>
            </div>
        </div>
        <p class="mt-3 mb-0"><strong>Note:</strong> Requirements vary by growth stage. These are average estimates.</p>
    `;
    document.getElementById('water-result').style.display = 'block';
}

function calculateFertilizer() {
    const crop = document.getElementById('fert-crop').value;
    const area = parseFloat(document.getElementById('fert-area').value);
    const soil = document.getElementById('fert-soil').value;
    
    const baseN = 10, baseP = 5, baseK = 8;
    let multiplier = 1;
    
    if (['sandy', 'acidic', 'saline'].includes(soil)) multiplier = 1.3;
    else if (['loam', 'alluvial', 'volcanic'].includes(soil)) multiplier = 0.8;
    
    const nitrogen = (baseN * area / 1000 * multiplier).toFixed(1);
    const phosphorus = (baseP * area / 1000 * multiplier).toFixed(1);
    const potassium = (baseK * area / 1000 * multiplier).toFixed(1);
    
    document.getElementById('fert-result').innerHTML = `
        <h5><i class="bi bi-flower3"></i> Fertilizer Requirements (NPK)</h5>
        <div class="row text-center">
            <div class="col-4">
                <div class="result-value">${nitrogen} kg</div>
                <p class="text-muted mb-0">Nitrogen (N)</p>
            </div>
            <div class="col-4">
                <div class="result-value">${phosphorus} kg</div>
                <p class="text-muted mb-0">Phosphorus (P)</p>
            </div>
            <div class="col-4">
                <div class="result-value">${potassium} kg</div>
                <p class="text-muted mb-0">Potassium (K)</p>
            </div>
        </div>
        <p class="mt-3 mb-0"><strong>Tip:</strong> Apply in split doses for better efficiency. Consider soil test for precise needs.</p>
    `;
    document.getElementById('fert-result').style.display = 'block';
}

function calculateLabor() {
    const activity = document.getElementById('labor-activity').value;
    const area = parseFloat(document.getElementById('labor-area').value);
    
    const hoursPerHectare = LABOR_RATES[activity] || 5;
    const totalHours = (hoursPerHectare * area / 10000).toFixed(1);
    const workers = Math.ceil(totalHours / 8);
    const days = Math.ceil(totalHours / (workers * 8));
    
    const activityName = document.getElementById('labor-activity').selectedOptions[0].text;
    
    document.getElementById('labor-result').innerHTML = `
        <h5><i class="bi bi-people-fill"></i> Labor Requirements for ${activityName}</h5>
        <div class="row text-center">
            <div class="col-4">
                <div class="result-value">${totalHours}</div>
                <p class="text-muted mb-0">Total Hours</p>
            </div>
            <div class="col-4">
                <div class="result-value">${workers}</div>
                <p class="text-muted mb-0">Workers Needed</p>
            </div>
            <div class="col-4">
                <div class="result-value">${days}</div>
                <p class="text-muted mb-0">Days to Complete</p>
            </div>
        </div>
        <p class="mt-3 mb-0"><strong>Note:</strong> Based on standard work rates. Actual time may vary with terrain and tools.</p>
    `;
    document.getElementById('labor-result').style.display = 'block';
}
</script>
{% endblock %}
